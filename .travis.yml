sudo: false
language: generic
cache:
  directories:
  - $HOME/.stack
ddons:
  apt:
    packages:
      - libgmp-dev

before_install:
# Download and unpack the stack executable
- mkdir -p ~/.local/bin
- export PATH=$HOME/.local/bin:$PATH
- travis_retry curl -L https://www.stackage.org/stack/linux-x86_64 | tar xz --wildcards -
-strip-components=1 -C ~/.local/bin '*/stack'

install:
    - stack install hakyll
    - stack ghc site.hs
script: ./site build
env:
  global:
    secure: prOUp/nvgsMzZRbBxKqNklD1JsCWTgWXbEblCEli7sDYRSbaMgw6HTyu9/iWKhXR+F3EQoBVncjGeKgb5C5M4aaB8hyX17NILOnu0ztm3fOd/fKFCqUsfnXlTQjR2xPD5QjBbXRTs52wKDhGxsDsrjv+bbzo1s4nk2nO9wcNgSo=
machine:
    timezone:
        Europe/Berlin
after_success:
    - git config --global user.email ob@cs.hm.edu
    - git config --global user.name Travis CI
    - cd _site/
    - git add .
    - git commit -m "Update (`date '+%F %T %Z'`)"
    - git push "https://${GH_TOKEN}@github.com/obcode/ob.cs.hm.edu.git" gh-pages

